<div class="container-fluid">
  <div class="row">
    <!-- Sidebar -->
    <div class="col-md-2">
      <app-sidebar-admin></app-sidebar-admin>
    </div>

    <!-- Nội dung chính -->
    <div class="col-md-10">
      <app-header></app-header>

      <!-- Thẻ cha cho phần card -->
      
        <div class="card shadow-sm mt-5 mb-5">
          <!-- Form thêm ca làm việc -->
          <form
            *ngIf="!editableTimeSlot"
            class="history-form shadow p-4 mb-4 bg-white rounded"
            (ngSubmit)="createTimeSlot()"
          >
            <div class="row">
              <h2 class="text-center">Quản lý Ca Làm Việc</h2>

              <div class="col-md-6 mb-3">
                <label for="doctor" class="form-label">Chọn bác sĩ</label>
                <select
                  class="form-control"
                  id="doctor"
                  [(ngModel)]="selectedDoctorId"
                  name="doctorId"
                  (change)="onDoctorSelect()"
                >
                  <option value="">-- Chọn bác sĩ --</option>
                  <option *ngFor="let doctor of doctors" [ngValue]="doctor.id">
                    {{ doctor.name }}
                  </option>
                </select>
              </div>

              <div class="col-md-6 mb-3">
                <label for="schedule" class="form-label">Lịch trình</label>
                <select
                  class="form-control"
                  id="schedule"
                  [(ngModel)]="newTimeSlot.scheduleId"
                  name="schedule"
                >
                  <option
                    *ngFor="let schedule of schedules"
                    [ngValue]="schedule.id"
                  >
                    {{ schedule.date }}
                  </option>
                </select>
              </div>
            </div>

            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="startTime" class="form-label"
                  >Thời gian bắt đầu</label
                >
                <input
                  type="time"
                  class="form-control"
                  id="startTime"
                  [(ngModel)]="newTimeSlot.startTime"
                  name="startTime"
                  required
                />
              </div>
              <div class="col-md-6 mb-3">
                <label for="endTime" class="form-label"
                  >Thời gian kết thúc</label
                >
                <input
                  type="time"
                  class="form-control"
                  id="endTime"
                  [(ngModel)]="newTimeSlot.endTime"
                  name="endTime"
                  required
                />
              </div>
            </div>

            <div class="row">
              <div class="col-md-12 mb-3">
                <label for="status" class="form-label">Trạng thái</label>
                <select
                  class="form-control"
                  id="status"
                  [(ngModel)]="newTimeSlot.isAvailable"
                  name="isAvailable"
                  required
                >
                  <option value="true">Có sẵn</option>
                  <option value="false">Không có sẵn</option>
                </select>
              </div>
            </div>

            <button type="submit" class="btn btn-primary w-100">
              Lưu ca làm việc
            </button>
          </form>

          <!-- Form sửa ca làm việc -->
          <form
            *ngIf="editableTimeSlot"
            class="history-form shadow p-4 mb-4 bg-white rounded"
            (ngSubmit)="saveUpdatedTimeSlot()"
          >
            <div class="row">
              <h2 class="text-center">Sửa Ca Làm Việc</h2>

              <div class="col-md-6 mb-3">
                <label for="doctor" class="form-label">Chọn bác sĩ</label>
                <select
                  class="form-control"
                  id="doctor"
                  [(ngModel)]="editableTimeSlot.doctorId"
                  name="doctorId"
                  (change)="onDoctorSelect()"
                >
                  <option value="">-- Chọn bác sĩ --</option>
                  <option *ngFor="let doctor of doctors" [ngValue]="doctor.id">
                    {{ doctor.name }}
                  </option>
                </select>
              </div>

              <div class="col-md-6 mb-3">
                <label for="schedule" class="form-label">Lịch trình</label>
                <select
                  class="form-control"
                  id="schedule"
                  [(ngModel)]="editableTimeSlot.scheduleId"
                  name="schedule"
                >
                  <option
                    *ngFor="let schedule of schedules"
                    [ngValue]="schedule.id"
                  >
                    {{ schedule.id }}
                  </option>
                </select>
              </div>
            </div>

            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="startTime" class="form-label"
                  >Thời gian bắt đầu</label
                >
                <input
                  type="time"
                  class="form-control"
                  id="startTime"
                  [(ngModel)]="editableTimeSlot.startTime"
                  name="startTime"
                  required
                />
              </div>
              <div class="col-md-6 mb-3">
                <label for="endTime" class="form-label"
                  >Thời gian kết thúc</label
                >
                <input
                  type="time"
                  class="form-control"
                  id="endTime"
                  [(ngModel)]="editableTimeSlot.endTime"
                  name="endTime"
                  required
                />
              </div>
            </div>

            <div class="row">
              <div class="col-md-12 mb-3">
                <label for="status" class="form-label">Trạng thái</label>
                <select
                  class="form-control"
                  id="status"
                  [(ngModel)]="editableTimeSlot.isAvailable"
                  name="isAvailable"
                  required
                >
                  <option value="true">Có sẵn</option>
                  <option value="false">Không có sẵn</option>
                </select>
              </div>
            </div>

            <button type="submit" class="btn btn-primary w-100">
              Lưu thay đổi
            </button>
          </form>

          <div class="card-body">
            <table class="table table-striped table-hover">
              <thead class="thead-light">
                <tr>
                  <th>#</th>
                  <th>Bác sĩ</th>
                  <th>Lịch trình</th>
                  <th>Thời gian</th>
                  <th>Trạng thái</th>
                  <th>Thao tác</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let timeslot of paginatedTimeSlots; let i = index">
                  <td>{{ i + 1 }}</td>
                  <td>{{ getDoctorName(timeslot.doctorId) }}</td>
                  <td>{{ timeslot.scheduleDate }}</td>
                  <td>{{ timeslot.startTime }} - {{ timeslot.endTime }}</td>
                  <td>
                    <span
                      class="status-badge"
                      [ngClass]="
                        timeslot.isAvailable
                          ? 'status-available'
                          : 'status-unavailable'
                      "
                    >
                      {{ timeslot.isAvailable ? "Có sẵn" : "Không có sẵn" }}
                    </span>
                  </td>
                  <td>
                    <button
                      class="btn btn-warning btn-sm mr-2"
                      (click)="editTimeSlot(timeslot.id)"
                    >
                      Sửa
                    </button>
                    <button
                      class="btn btn-danger btn-sm"
                      (click)="deleteTimeSlot(timeslot.id)"
                    >
                      Xóa
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
            <div>
              <button (click)="previousPage()" [disabled]="currentPage === 1">
                Trang trước
              </button>
              <span>Trang {{ currentPage }}</span>
              <button
                (click)="nextPage()"
                [disabled]="currentPage === totalPages()"
              >
                Trang sau
              </button>
            </div>
          </div>
        </div>

      <app-footer></app-footer>
    </div>
  </div>
</div>
